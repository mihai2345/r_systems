<!DOCTYPE html>
<html lang="ro">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Resume Analyzer - Login</title>
    <style>
        body { font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; background-color: #f4f7f6; }
        .auth-container { background: #ffffff; padding: 40px; border-radius: 12px; box-shadow: 0 6px 18px rgba(0,0,0,0.07); width: 350px; text-align: center; }
        h2 { color: #007bff; margin-bottom: 25px; }
        input[type="email"], input[type="password"], input[type="text"] { width: 100%; padding: 12px; margin-bottom: 15px; border: 1px solid #ced4da; border-radius: 8px; box-sizing: border-box; }
        button { background-color: #007bff; color: white; padding: 12px; border: none; border-radius: 8px; cursor: pointer; width: 100%; font-size: 16px; font-weight: 600; }
        button:hover { background-color: #0056b3; }
        #message { margin-top: 20px; font-weight: 600; }
        .links { margin-top: 20px; display: flex; justify-content: space-between; font-size: 14px; }
        .links a { color: #007bff; text-decoration: none; }
        .links a:hover { text-decoration: underline; }
        .password-wrapper { position: relative; width: 100%; }
        .password-wrapper input { padding-right: 45px; }
        .toggle-password { position: absolute; top: 50%; right: 15px; transform: translateY(-50%); cursor: pointer; color: #6c757d; border: none; background: none; padding: 0; margin-top: -7.5px; }
        .toggle-password svg { width: 20px; height: 20px; }
    </style>
</head>
<body>
    <div class="auth-container">
        <h2>Bine ai venit!</h2>
        <p style="color: #6c757d; margin-top: -15px; margin-bottom: 20px;">Accesează Resume Analyzer-ul tău</p>
        
        <form id="loginForm">
            <input type="email" id="email" placeholder="Email" required>
            <div class="password-wrapper">
                <input type="password" id="password" placeholder="Parolă" required>
                <span class="toggle-password" id="togglePassword">
                    <svg id="eye-open" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z"></path><circle cx="12" cy="12" r="3"></circle></svg>
                    <svg id="eye-closed" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" style="display: none;"><path d="M17.9 17.9C16.1 19.4 14.1 20 12 20c-3.2 0-6.1-1.9-9-5 1.1-1.7 2.4-3.1 3.9-4.2M10 12.5a2 2 0 0 1-2-2M14 14l-4-4M10.1 6.1C10.7 6.1 11.3 6 12 6c3.2 0 6.1 1.9 9 5-1.1 1.7-2.4 3.1-3.9 4.2M14 12a2 2 0 0 1-2 2"></path><line x1="2" x2="22" y1="2" y2="22"></line></svg>
                </span>
            </div>
            <button type="submit">Conectează-te (Login)</button>
        </form>
        
        <div id="message"></div>
        
        <div class="links">
            <a href="/static/forgot-password.html">Am uitat parola</a>
            <a href="/static/register.html">Creează cont</a>
        </div>
    </div>

    <script>
        function setupPasswordToggle(inputId, toggleId, eyeOpenId, eyeClosedId) {
            const passwordInput = document.getElementById(inputId);
            const toggleButton = document.getElementById(toggleId);
            const eyeOpen = document.getElementById(eyeOpenId);
            const eyeClosed = document.getElementById(eyeClosedId);
            
            if (!passwordInput || !toggleButton || !eyeOpen || !eyeClosed) return;

            toggleButton.addEventListener('click', function() {
                const isPassword = passwordInput.type === 'password';
                passwordInput.type = isPassword ? 'text' : 'password';
                eyeOpen.style.display = isPassword ? 'none' : 'block';
                eyeClosed.style.display = isPassword ? 'block' : 'none';
            });
        }

        setupPasswordToggle('password', 'togglePassword', 'eye-open', 'eye-closed');

        document.getElementById('loginForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            
            const email = document.getElementById('email').value;
            const password = document.getElementById('password').value;
            const messageDiv = document.getElementById('message');
            
            messageDiv.innerHTML = 'Se procesează...';
            messageDiv.style.color = 'blue';

            try {
                const response = await fetch('/api/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email, password })
                });

                const data = await response.json();
                
                if (response.ok) {
                    messageDiv.innerHTML = "Autentificare reușită!";
                    messageDiv.style.color = 'green';
                    
                    // --- MODIFICARE CHEIE ---
                    // Salvează token-ul în localStorage
                    localStorage.setItem('access_token', data.access_token);
                    
                    // Redirecționează manual la dashboard
                    window.location.href = '/static/dashboard.html';
                    
                } else {
                    messageDiv.innerHTML = data.detail || 'Eroare necunoscută.';
                    messageDiv.style.color = 'red';
                }
            } catch (error) {
                messageDiv.innerHTML = 'Eroare de rețea. Serverul nu răspunde.';
                messageDiv.style.color = 'red';
            }
        });
    </script>
</body>
</html>